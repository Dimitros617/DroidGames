@page "/admin/teams"
@inject BlazorApp1.Services.ITeamService TeamService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Správa týmů - Hlavní rozhodčí</PageTitle>

<BlazorApp1.Components.Shared.AuthGuard RequiredRole="BlazorApp1.Models.UserRole.HeadReferee">
    <BlazorApp1.Components.Shared.AdminNav />
    
    <div class="page-shell admin-teams">
        <div class="page-header">
            <div>
                <h1 class="page-title">
                    <span class="material-symbols-outlined">groups</span>
                    Správa týmů
                </h1>
                <p class="page-subtitle">Jednotný přehled týmů, PIN kódů a rychlých odkazů na detail jízd.</p>
            </div>
        </div>

        @if (_isLoading)
        {
            <div class="state-card">
                <span class="material-symbols-outlined spinning">progress_activity</span>
                <p>Načítání týmů...</p>
            </div>
        }
        else if (_teams != null && _teams.Any())
        {
            <div class="table-card teams-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Název týmu</th>
                            <th>Škola</th>
                            <th>PIN</th>
                            <th>Celkové skóre</th>
                            <th>Pozice</th>
                            <th>Kola</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var team in _teams)
                        {
                            <tr>
                                <td class="team-name">@team.Name</td>
                                <td>@team.School</td>
                                <td class="team-pin">@team.PinCode</td>
                                <td class="team-score">@team.TotalScore bodů</td>
                                <td class="team-position">@team.CurrentPosition.</td>
                                <td>@team.Rides.Count</td>
                                <td class="team-actions">
                                    <button class="btn-icon btn-primary" @onclick="() => NavigateToRides(team.Id)" title="Zobrazit jízdy">
                                        <span class="material-symbols-outlined">list</span>
                                    </button>
                                    <button class="btn-icon btn-info" @onclick="() => NavigateToEdit(team.Id)" title="Upravit">
                                        <span class="material-symbols-outlined">edit</span>
                                    </button>
                                    <button class="btn-icon btn-danger" @onclick="() => DeleteTeam(team.Id)" title="Smazat">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="state-card">
                <span class="material-symbols-outlined">groups</span>
                <p>Žádné týmy ještě nebyly přidány</p>
            </div>
        }
    </div>
</BlazorApp1.Components.Shared.AuthGuard>

@code {
    private List<BlazorApp1.Models.Team>? _teams;
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadTeams();
    }

    private async Task LoadTeams()
    {
        _isLoading = true;
        _teams = await TeamService.GetLeaderboardAsync();
        _isLoading = false;
        StateHasChanged();
    }

    private void NavigateToRides(string teamId)
    {
        Navigation.NavigateTo($"/admin/teams/{teamId}/rides");
    }

    private void NavigateToEdit(string teamId)
    {
        Navigation.NavigateTo($"/admin/teams/{teamId}/edit");
    }

    private void DeleteTeam(string teamId)
    {
        // TODO: Implementovat potvrzovací dialog
        // Zatím neimplementováno pro bezpečnost
    }
}
